<div
  class="search-block"
  data-controller="searches google-maps-autocomplete"
  data-searches-min-duration="1"
  data-searches-max-duration="<%= Reservation.default.max_duration %>"
  data-searches-min-people-count="1"
  data-searches-max-people-count="<%= Reservation.default.max_people_count %>"
>
  <div class="container">
    <div class="d-flex align-items-center justify-content-around justify-content-sm-between child-mx-2 my-2">
      <div class="d-flex-default child-mx-2 pointer" data-action="click->searches#toggleBodyVisibility">
        <i class="fa fa-search"></i>
        <div id='infos-address' data-target="google-maps-autocomplete.shortAddress searches.address"><%= @search.address %></div>
        <div data-target="searches.startAt">
          <%= display_datetime_for(@search.start_at,
                                   join_expression: 'à',
                                   without_year: true,
                                   time_separator: ':') %>
        </div>
        <div>Pour <span data-target="searches.peopleCount"><%= @search.people_count %></span></div>
      </div>

      <% if @search.persisted? %>
        <%= link_to update_all_searches_path, class: 'd-flex-default text-white opacity-hover', method: :patch, remote: true do %>
          <span class="d-none d-sm-block mr-2">Annuler la recherche</span>
          <i class="fa fa-times fa-lg"></i>
        <% end %>
      <% end %>
    </div>
    <div class="search-block-body" data-target="searches.body">
      <div class="container">
        <%= simple_form_for @new_search, remote: true do |f| %>
          <div class="row">
            <div class="col-12">
              <div class="w-100">
                <%= f.input :address,
                            label: false,
                            placeholder: 'Ville, adresse ...',
                            input_html: {
                              class: 'w-100',
                              data: {
                                action: 'keyup->searches#updateAddressAndClearVisibility',
                                target: 'google-maps-autocomplete.addressInput searches.addressInput'
                              }
                            }
                %>
                <i
                  id="search_address_clear"
                  class="fa fa-times"
                  aria-hidden="true"
                  data-action="click->searches#clearAddress"
                  data-target="searches.addressClear"
                ></i>
              </div>
            </div>
            <div class="col-12">
              <%= f.input :start_at,
                          label: false,
                          placeholder: 'Date & heure',
                          as: :string,
                          readonly: true,
                          input_html: {
                            value: display_datetime_for(
                              @search.start_at,
                              join_expression: 'à',
                              without_year: true,
                              time_separator: ':'
                            ),
                            data: {
                              action: 'click->searches#updateStartAtTarget',
                              controller: 'datetime-picker',
                              target: 'datetime-picker.startAtInput searches.startAtInput'
                            }
                          }
            %>
            </div>

            <!-- Nombre d'heures -->
            <div class="col-12 col-md-6">
              <div class="d-flex-default my-3">
                <i class="fa fa-minus-circle fa-2x" aria-hidden="true" data-action="click->searches#decrementDuration"></i>
                <div><span data-target="searches.duration"><%= @search.duration %></span> heure(s)</div>
                <i class="fa fa-plus-circle fa-2x" aria-hidden="true" data-action="click->searches#incrementDuration"></i>
              </div>
              <%= f.input :duration, input_html: { data: { target: 'searches.durationInput' } }, as: :hidden %>
            </div>

            <!-- Nombre de participants -->
            <div class="col-12 col-md-6">
              <div class="d-flex-default my-3">
                <i class="fa fa-minus-circle fa-2x" aria-hidden="true" data-action="click->searches#decrementPeopleCount"></i>
                <div><span data-target="searches.peopleCount"><%= @search.people_count %></span> personne(s)</div>
                <i class="fa fa-plus-circle fa-2x" aria-hidden="true" data-action="click->searches#incrementPeopleCount"></i>
              </div>
              <%= f.input :people_count, input_html: { data: { target: 'searches.peopleCountInput' } }, as: :hidden %>
            </div>
          </div>
          <div class="text-center">
            <%= f.button :button,
                         'CHERCHER',
                         type: :submit,
                         class: 'button button-white',
                         data: {
                           controller: 'analytics-events',
                           action: 'click->analytics-events#userSearchSubmit'
                         }
            %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
