<script>
  document.addEventListener("turbolinks:load", function() {
    var handler = StripeCheckout.configure({
      key: '<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>',
      image: '<%= image_path 'cookoon_logo' %>',
      locale: 'fr',
      email: '<%= current_user.email %>',
      token: function(token) {
        $("#stripe_token").val(token.id);
        $('#customButton').prop("disabled", true);
        $('#customButton').html('<i class="fa fa-spinner fa-spin" style="margin-right: 10px;"></i>Chargement');
        $("#stripe_form").submit();
      }
    });

    document.getElementById('customButton').addEventListener('click', function(e) {
      // Open Checkout with further options:
      handler.open({
        name: 'Cookoon.fr',
        description: 'Paiement de votre r√©servation',
        zipCode: true,
        currency: 'eur',
        amount: <%= @reservation.price_for_rent_with_fees.fractional %>
      });
      e.preventDefault();
    });

    // Close Checkout on page navigation:
    window.addEventListener('popstate', function() {
      handler.close();
    });
  });
</script>
