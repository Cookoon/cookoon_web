<% content_for :navbar do %>
  <%= render 'shared/navbar_light', url: cookoon_path(@reservation.cookoon) %>
<% end %>

<div class="container">
  <h2>Payez votre réservation</h2>

  <b>Votre location :</b>
  <br><br>
  <p>le <b><%= display_datetime_for(@reservation.date) %></b> pour <b><%= display_duration_for(@reservation) %></b></p>

  <div class="light-padded">
    <div class="flex-container">
      <p>Prix de la location</p>
      <p><%= humanized_money_with_symbol @reservation.price %></p>
    </div>
    <div class="flex-container">
      <p>Frais de services</p>
      <p><%= humanized_money_with_symbol @reservation.cookoon_fees %></p>
    </div>
    <hr>
    <div class="flex-container">
      <b>TOTAL</b>
      <b><%= humanized_money_with_symbol @reservation.price_for_rent_with_fees %></b>
    </div>
  </div>

  <!-- ========= CARD SELECTION ============= -->
  <% if @user_cards.blank? %>
    <div class="text-center thin-padded">
      <div class="thin-padded">
        <p>Vous n'avez aucun moyen de paiement</p>
        <p>Vous devez en ajouter un avant de pouvoir faire une demande de réservation</p>
      </div>
      <%= link_to 'Ajouter une carte', credit_cards_path, class: 'button button-blue' %>
    </div>
  <% else %>
    <%= simple_form_for :paiement, url: reservation_paiements_path(@reservation), remote: true, html: { id: 'pay-form' } do |f| %>
      <div class="credit-card-select">
        <i class="fa fa-credit-card" aria-hidden="true"></i>
        <%= f.input :source, collection: @user_cards, selected: :first, label: false, label_method: ->(card){ "#{card.brand.upcase} XXXX-XXXX-XXXX-#{card.last4}" }, value_method: ->(card){ card.id } %>
      </div>
      <div class="text-center">
        <%= f.button :button, 'PAYER', as: :submit, class: 'button button-blue', id: 'pay-button' %>
      </div>
    <% end %>
    <div class="text-center">
      <div style="font-size:12px; margin-top: 15px">
        <p>
          Votre carte bleue ne sera débitée que si l'Hôte accepte votre demande de location.
        </p>
        <p>
          Attention : nous procédons tout de même à une demande d'autorisation de paiement sur votre compte.
        </p>
      </div>
    </div>
  <% end %>
  <!-- ========= END CARD SELECTION ============= -->
</div>

<script>
  var form = document.getElementById('pay-form');
  var $button = $('#pay-button');
  form.addEventListener('submit', function(event) {
    $button.prop("disabled", true);
    $button.html('<i class="fa fa-spinner fa-spin" style="margin-right: 10px;"></i>Chargement');
  });
</script>
